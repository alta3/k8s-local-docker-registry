---
apiVersion: extensions/v1beta1
kind: Deployment
metadata:
  labels:
    app: docker-private-registry
  name: docker-private-registry-deployment
spec:
  replicas: 1
  selector:
    matchLabels:
      app: docker-private-registry
  template:
    metadata:
      labels:
        app: docker-private-registry
    spec:
      containers:
      - image: registry:2
        imagePullPolicy: IfNotPresent
        name: docker-private-registry
        env: 
        - name: REGISTRY_HTTP_ADDR
          value: 0.0.0.0:5000
        - name: REGISTRY_HTTP_TLS_CERTIFICATE
          value: /certs/cert.crt
        - name: REGISTRY_HTTP_TLS_KEY
          value: /certs/cert.key
        ports:
        - containerPort: 5000
          protocol: TCP
        volumeMounts:
        - mountPath: /var/lib/registry
          name: image-store
        - mountPath: /certs
          name: certs
      volumes:
      - emptyDir: {} # THIS IS NOT PERSISTANT! WILL DELETE WITH POD!
        name: image-store
      - name: certs
        secret:
          secretName: registry-tls
          items:
          - key: tls.crt
            path: cert.crt
            mode: 256 # 0400 in decimal
          - key: tls.key
            path: cert.key
            mode: 256 # 0400 in decimal
---
apiVersion: v1
kind: Service
metadata:
  labels:
    service: docker-private-registry
  name: docker-private-registry
spec:
  ports:
  - nodePort: 30500
    port: 5000
    protocol: TCP
    targetPort: 5000
  selector:
    app: docker-private-registry
  type: NodePort

---
apiVersion: v1
kind: Secret
data:
  tls.crt: LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSUVBVENDQXVtZ0F3SUJBZ0lVZXdFMGNFaVdla0lydFdQMWdGTkRkcWV6V0hVd0RRWUpLb1pJaHZjTkFRRUwKQlFBd2NERUxNQWtHQTFVRUJoTUNWVk14RlRBVEJnTlZCQWdUREZCbGJtNXplV3gyWVc1cFlURVRNQkVHQTFVRQpCeE1LU0dGeWNtbHpZblZ5WnpFVE1CRUdBMVVFQ2hNS1MzVmlaWEp1WlhSbGN6RUxNQWtHQTFVRUN4TUNRMEV4CkV6QVJCZ05WQkFNVENrdDFZbVZ5Ym1WMFpYTXdIaGNOTVRneE1ESXdNakl6TXpBd1doY05NVGt4TURJd01qSXoKTXpBd1dqQ0JnekVMTUFrR0ExVUVCaE1DVlZNeEZUQVRCZ05WQkFnVERGQmxibTV6ZVd4MllXNXBZVEVUTUJFRwpBMVVFQnhNS1NHRnljbWx6WW5WeVp6RVJNQThHQTFVRUNoTUljbVZuYVhOMGNua3hJVEFmQmdOVkJBc1RHRXQxClltVnlibVYwWlhNZ1ZHaGxJRUZzZEdFeklGZGhlVEVTTUJBR0ExVUVBeE1KTVRJM0xqQXVNQzR4TUlJQklqQU4KQmdrcWhraUc5dzBCQVFFRkFBT0NBUThBTUlJQkNnS0NBUUVBb0hyWnFpOWxJemMvMmdQL0VWaUNOOWFoQ016VApSZmtKUDF0RzI4ZjRkNmYrTDBEYVdOdk1UbEVDQUNydDZsRDgvYUNkN3JUNERXRjZHUGZQVit6REtnR29vOGJzCmp3Z0xwOGEwVUdOQ0F6TUN0YWpqZXlNNG5UOGpSbGEwT2hjSUJ4eW9IdU1ka0haV1IzNGkvSmVpaXV5OGJlM3QKZzJjdkltUVhCQmlHUkM4SnBBSURZY3NhUkNqcmE3TEo3S1pNTThBRDZla2FCSDNwK3FhcllKTmMwOFdsdSs2TwpKbWZkRzhMQk85azJNb0UvM3Z2cGZKR1JPZE4vOTFROHV6RXdZcmZ1T3R0ckZ6aVgzcDFKZ2JwNEg3T01pUE5UCmRYc1UwdDdYaG5INWxmQWJja0QvSFpYTU94L09DSDZ3TlpDWTZHZGV1czRTWEZTUndlckR4Ym5SU1FJREFRQUIKbzM4d2ZUQU9CZ05WSFE4QkFmOEVCQU1DQmFBd0hRWURWUjBsQkJZd0ZBWUlLd1lCQlFVSEF3RUdDQ3NHQVFVRgpCd01DTUF3R0ExVWRFd0VCL3dRQ01BQXdIUVlEVlIwT0JCWUVGS2RRRWYyWm1nNGRPUDQyVHcwVlhoQTdTMzU0Ck1COEdBMVVkSXdRWU1CYUFGRVZ1M0VVVmhONkNqRUhNU0RNVVB6bmxZbXFoTUEwR0NTcUdTSWIzRFFFQkN3VUEKQTRJQkFRQnRpeG05bzNkTkkzczhTMlJVZGxIK2RZRi9uWEJpUGtIYVMyRUNxR3psM1ZQTk41NDR3anJDZW1rdApMS09JOGJWcFBpOCtzT0Q3MHlsSDJkSWNub3ZTSjd1Q1p4ZHZlNkRnbVNkTWVOK1Z4QzlUUXIyWG9CeXE4YnRWCjVXMGljR1diUVhqN2NZbzhHVURHYXZuNnBQbVhvMUpKUFhqTFRCQ2w1NXlaYkdJK2JVVndMa0lWS0tGRWQzcWIKdjRVUzVnTXFNWmNhckhmZTZmUEtlK0t4MjVJWW5FYlBZbjFwb1FSTGpRZ0hlSkF3M0NLWk4zVUpTMW1xbFdZcwpkY0JRL2F5K1RJVG9Ody9PbmNRQ0x5bHZ1TWduYVcvOFFUazc0Z3Azb2t3S054d0NySngrek5TaDNTb3VDYWRrCnRvaVh0c1h3M1ZCUjVFbm9tcml5c2JJd2VxWjUKLS0tLS1FTkQgQ0VSVElGSUNBVEUtLS0tLQo=
  tls.key: LS0tLS1CRUdJTiBSU0EgUFJJVkFURSBLRVktLS0tLQpNSUlFb3dJQkFBS0NBUUVBb0hyWnFpOWxJemMvMmdQL0VWaUNOOWFoQ016VFJma0pQMXRHMjhmNGQ2ZitMMERhCldOdk1UbEVDQUNydDZsRDgvYUNkN3JUNERXRjZHUGZQVit6REtnR29vOGJzandnTHA4YTBVR05DQXpNQ3RhamoKZXlNNG5UOGpSbGEwT2hjSUJ4eW9IdU1ka0haV1IzNGkvSmVpaXV5OGJlM3RnMmN2SW1RWEJCaUdSQzhKcEFJRApZY3NhUkNqcmE3TEo3S1pNTThBRDZla2FCSDNwK3FhcllKTmMwOFdsdSs2T0ptZmRHOExCTzlrMk1vRS8zdnZwCmZKR1JPZE4vOTFROHV6RXdZcmZ1T3R0ckZ6aVgzcDFKZ2JwNEg3T01pUE5UZFhzVTB0N1hobkg1bGZBYmNrRC8KSFpYTU94L09DSDZ3TlpDWTZHZGV1czRTWEZTUndlckR4Ym5SU1FJREFRQUJBb0lCQUM5UHFJWVV6UE5SNFlBcgp0M0hzcnc4NU5tWjZ4RHFYemRNZzNNWUVzVXJOZXhHQlJCMzRSc1k3K2FRRkEva1ZnVkJnbnM3MkNUOGdvcmRqCnIzd1RjQUlkVlJOYm5QZ1ovaDJyWmhOZy8rQWpsTVByazQwRStEYmJtMUdzVkJ2Z0dGeklaUVFlSHVRdER3aXEKdGpQVG5IYnFqaTYyZTFSSEFrMVlSclROYWlBRmFtZDY3WmtlM01xVVJwL3RLZVpzWndybTlTc1VKVjZ6QitWWAp1bE9hQXo3SW1SRzJEcitQUEtBVFlWSU1zL0VTZHlCVkVnTjZZYzJSV21vSUJBVmFSb28wbHdoaUF3RHdOT25DCkpHTldhMzVPRmJlRENnSlZUNXdYalIyaGpHM0pSWnJPdDgyeUI2NnRncXc3NDlQSEtPTWdiYXFDZldyd0ZOVHUKd21MSzFwRUNnWUVBd2MyaGxyTE1iV1N6ZmFYUllHRXJ3ai83N25DRmlTUHBUUEw5UWZsZk1GVFRhSThkaEQ4YQpjckp6TGJFOHJkNThrbGp3T3pBYVNSY0JyUyt5V292cUFGdGVGdnUzOTBHZEVBVWZIWWRxV2t6YjBDb0tYeTZICnRhTjJYSEtSR0FDV1VrVi9hU3V6dlIvM1ljVDVqdVdRc0o1TGFVVDBwd0ZhSm53L05sR01DUDBDZ1lFQTAvdDEKWW41cU11Yi9PVzcyNUg3WStqMlJTSGpvWTdsUTRyZ1dtRUFMeWxTZzNFWmpGZUx1SHRTSFJmd0htc0wrVkJwcQpKY2RGL1JwV2NQQWVQdXBWMUlGNUVVZ0FoVk1wQUVjYnBPT3ZUamN6MlM1a2I0eDBmZis3ckhoNXdjZUV2L2NUCnJIQUdEY1dQdWltenNIRUxmZjdiOXdMckRrdlFVODUzZ01RMGNUMENnWUVBcG1HcmdIMHdGQnFJSGk3bGVpRHkKT0dwR0Y0WnluakkrY05tTG84QTdnSHJTcE1sNVJiZ0hOTUVQTVFNZ1hRVE5YYmNOUjBNY3pmTDZkWHlsV2ljVQpWZ29hMVJCMTk4aFUxeFFPaW9OZlF2Y0pIOFYzOGc4NFl6QmF4VE4yYld6VG9QNFpUR2xBZmZXYnBFdy9FL2J5CktTODgvcnM4YnNReWFTZngvT2cxbU9FQ2dZQmpNbXkvNW9BenlienRWMnZaaVRKb0I1K1ExbU9KSnhNZXhSNXQKcUtyYng3WnUzZEZJVUtVMWNDYk5MUjh4NE1XNi9aRm1sRlhBRnk4VU1vazB6OXZTVWJRaHpodlFTQllMdHpyTQpjbTk2bm9KNHd5amt1a2xaSE83cHlvYlBrMW9mcXJOZUloM3pHOXdpTlptTW01blJJQTQzRFBxSitoaEczM3MwCm1wd2YwUUtCZ0NBNXhkUmh3bUhSNjN4VWNHenVKVmxHYjdVM25wbkNPNnZneFQvbnJSem5LWTJEem5PMzBYUjkKTXNkQTdySVhLbVFmVWh3ejQ4dDZWaXBCYmIxSWRlWVFtZndmaEVlTGlkb1BoaXZaNUNQWVk4U1kyS2VOQmFKLwoxcFFBTTNEZ0VNbCtZbFl3dUhWbWU2SmhHcjFQOW8zRzU3SWNjVlIrRlhjZytiVktaQlo3Ci0tLS0tRU5EIFJTQSBQUklWQVRFIEtFWS0tLS0tCg==
metadata:
  name: registry-tls
  namespace: default
type: Opaque

