---
apiVersion: extensions/v1beta1
kind: Deployment
metadata:
  labels:
    app: docker-private-registry
  name: docker-private-registry-deployment
spec:
  replicas: 1
  selector:
    matchLabels:
      app: docker-private-registry
  template:
    metadata:
      labels:
        app: docker-private-registry
    spec:
      containers:
      - image: registry:2
        imagePullPolicy: IfNotPresent
        name: docker-private-registry
        env: 
        - name: REGISTRY_HTTP_ADDR
          value: 0.0.0.0:5000
        - name: REGISTRY_HTTP_TLS_CERTIFICATE
          value: /certs/cert.crt
        - name: REGISTRY_HTTP_TLS_KEY
          value: /certs/cert.key
        ports:
        - containerPort: 5000
          protocol: TCP
        volumeMounts:
        - mountPath: /var/lib/registry
          name: image-store
        - mountPath: /certs
          name: certs
      volumes:
      - emptyDir: {} # THIS IS NOT PERSISTANT! WILL DELETE WITH POD!
        name: image-store
      - name: certs
        secret:
          secretName: registry-tls
          items:
          - key: tls.crt
            path: cert.crt
            mode: 256 # 0400 in decimal
          - key: tls.key
            path: cert.key
            mode: 256 # 0400 in decimal
---
apiVersion: v1
kind: Service
metadata:
  labels:
    service: docker-private-registry
  name: docker-private-registry
spec:
  ports:
  - nodePort: 30500
    port: 5000
    protocol: TCP
    targetPort: 5000
  selector:
    app: docker-private-registry
  type: NodePort

---
apiVersion: v1
kind: Secret
data:
  tls.crt: LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSUVERENDQXZTZ0F3SUJBZ0lVU2pCZlhFcG1HRjlYYTBra3lPbUZXUUZWb1VZd0RRWUpLb1pJaHZjTkFRRUwKQlFBd2NERUxNQWtHQTFVRUJoTUNWVk14RlRBVEJnTlZCQWdUREZCbGJtNXplV3gyWVc1cFlURVRNQkVHQTFVRQpCeE1LU0dGeWNtbHpZblZ5WnpFVE1CRUdBMVVFQ2hNS1MzVmlaWEp1WlhSbGN6RUxNQWtHQTFVRUN4TUNRMEV4CkV6QVJCZ05WQkFNVENrdDFZbVZ5Ym1WMFpYTXdIaGNOTVRneE1URTBNREl5TlRBd1doY05NVGt4TVRFME1ESXkKTlRBd1dqQnhNUXN3Q1FZRFZRUUdFd0pWVXpFVk1CTUdBMVVFQ0JNTVVHVnVibk41YkhaaGJtbGhNUk13RVFZRApWUVFIRXdwSVlYSnlhWE5pZFhKbk1STXdFUVlEVlFRS0V3cExkV0psY201bGRHVnpNU0V3SHdZRFZRUUxFeGhMCmRXSmxjbTVsZEdWeklGUm9aU0JCYkhSaE15QlhZWGt3Z2dFaU1BMEdDU3FHU0liM0RRRUJBUVVBQTRJQkR3QXcKZ2dFS0FvSUJBUUNyZGV0enZQUjZDbUFvamhFSWdYZHZ0UVdLTm92ck8rN2tJTnBPWGhQdHVNbldJN1h1QTA4egpuZVVPY0QzNGY4bll4a3NWN29sVTJVdHk5Um42WTZDYk4xR1lqd3lMd0VnUWJHeE9MVkxTL1c2aDFKZFREcGdjCnZZL2NCaUZHUzQzVDlack1TZjFxUW1YOEFGZEFiejV5djNtZGQreGJmb29weHM1RVE5TnB2ckJWWDNGUzBjanEKcjd2emRrbWxzMWQyQjVrMHBEUDBpWGNoRzNUZU1MV3JYYXhEUXJ1WGN3ZlVUeVRMR3JjV1hidlZoRDR1cWpuaworc0UydVk5OXd3UlVlbVFXaGEyemprTkpJTXBTTjZ2OUg3cVo4QXJhcGpraDFGSnZJcmZXanZQcC9tUXZmTHVxCjZ1VnVpNjlNWmsvdjJSUTVaVlFrZ1FaL052UnNwQVFYQWdNQkFBR2pnWnd3Z1prd0RnWURWUjBQQVFIL0JBUUQKQWdXZ01CMEdBMVVkSlFRV01CUUdDQ3NHQVFVRkJ3TUJCZ2dyQmdFRkJRY0RBakFNQmdOVkhSTUJBZjhFQWpBQQpNQjBHQTFVZERnUVdCQlRlTXkzZWFrWUlPOU5URVkvMUFjSGN2MS9SR3pBZkJnTlZIU01FR0RBV2dCVE0zSU5wCk54bDNoUVRlTFN3bDFaUy9lNVhDSERBYUJnTlZIUkVFRXpBUmdnbHNiMk5oYkdodmMzU0hCSDhBQUFFd0RRWUoKS29aSWh2Y05BUUVMQlFBRGdnRUJBS2xEQWdKRmZSbEFMR0RjdEFGRkRWNzRNV0lIY24yYVBJaE1tZEhoaEtXMQoxWG52VUdJQm5PV0NHU0dnbWFGRldpM200QjF0Zko3bjZhOW5kNHVlVHFtQzlEclNIbmpIQnNmcFp4NnpBRjhtCll2WEZMcWpDRHg5NmJjNk81YmVtL00yc3cyamtZMVJwVWtzc1dSRXdnN2NiYW5uZE9BWURmUHBlUG9jN2tKNnAKOGFTT0xkNlpNaU9IT1pCZjI0OHdrV1NGRCtTY2ZUbndOZ0lyS0tOdVhEUTRUS3MzbnB4bUcwY0g1WS9rN3pUNQplMTdQTDJBcFJpUHlSdzdhdjN5NXNFYVVtTzN3aGl2UE9tVlZEY0I4WmVTRzRzSWtoM1Bmb0FmVmppWW5FVlh5CkY4OXlScjJWd3ZDUXZLUzlrUzdubkZPNmVRMjNVWjFEYkt5S3Bpc2VZZzA9Ci0tLS0tRU5EIENFUlRJRklDQVRFLS0tLS0K
  tls.key: LS0tLS1CRUdJTiBSU0EgUFJJVkFURSBLRVktLS0tLQpNSUlFb2dJQkFBS0NBUUVBcTNYcmM3ejBlZ3BnS0k0UkNJRjNiN1VGaWphTDZ6dnU1Q0RhVGw0VDdiakoxaU8xCjdnTlBNNTNsRG5BOStIL0oyTVpMRmU2SlZObExjdlVaK21PZ216ZFJtSThNaThCSUVHeHNUaTFTMHYxdW9kU1gKVXc2WUhMMlAzQVloUmt1TjAvV2F6RW45YWtKbC9BQlhRRzgrY3I5NW5YZnNXMzZLS2NiT1JFUFRhYjZ3VlY5eApVdEhJNnErNzgzWkpwYk5YZGdlWk5LUXo5SWwzSVJ0MDNqQzFxMTJzUTBLN2wzTUgxRThreXhxM0ZsMjcxWVErCkxxbzU1UHJCTnJtUGZjTUVWSHBrRm9XdHM0NURTU0RLVWplci9SKzZtZkFLMnFZNUlkUlNieUszMW83ejZmNWsKTDN5N3F1cmxib3V2VEdaUDc5a1VPV1ZVSklFR2Z6YjBiS1FFRndJREFRQUJBb0lCQUgxMlBNS2t5ak9lOGZ2YQo4S1hMcm15a0JoaTdqeWlpNDB3MHFlbGNON0xrVzNTQkR2ZkpuaVBEN3I3ZzdNZXdJaStuOFh0cjN6dWlBTzV1CllRTHg4YXlDRHdmVjdMVTZEc0ZOeFBaemZiNTd5WDlMUXl0NGExL2thYWJ6S1ZmNW94OHRBWWRvd0xFSFF2N2gKOVBabU1Famd5UW1ybmR6WlBCb1RxZzBUb0Znb0IrNGR5Nm5IZHVqZVl6dS9ka09obEVteXBiVWx6T2Q0bStDcwozSUlCTmZiMVNya21aMC9MUkhqM1dIaEhrL1RwVkxCTEc3VnM2dXdOc3pUdkd5a2RsOTk0T3NocnJJcmMxWlo3CmZiNlhMN0YyMTdCNTlnVjlzbitUQnB4Z1poV2Y2T1YyOUFTK2FSRm45eXQwTjI3cnVXWHNYN0haSE1BcnNvK0UKcUs2NnlLRUNnWUVBNG9TZlNNRERxMU1od0g3cU0vU0ZWU3htZ3Y4c1dNUEVmUGlqY3VmL1FPUENlWFVxWTVTZgptTS94d2JucjZkVFpodUM4ZGxCWXhhWkhhT204U0hHdE9xelJTcFE5S2dab1dKRHBqQ0RLQ3h0c3REWStsL0hGCnJvUVRJQjBMUVdqeXoxbnpiWHM1YnlYTE1VYzU3TCtqYktCSVQxZ0NEMUk4ZEdReXBYRWdwZEVDZ1lFQXdjYlYKWFJDT214QUIzY2kzNlpTM2J5Zjh4VUpuMWVqUkM1alBabzdjU0h5VEZKNm5FUyt1VGRsRTlOZldrQ2xQbFdxbQo2RURXMWdBdmNFUTQzbSthalYvRFpSdGp3dTF1TEprc1JYMTZnNEJVbkR3Z2xHa2gxdzlOdk8yd0tjNlBQTDVMCmhJTnM3RVZRZzdDZWp0SVVLWlRMVm9mTHBBenE4NzkzNzVRMnZXY0NnWUJ3REM1R2JLUGRnWGUyb3BEek5rY20KQkpxSXZmU1B5L2JMNHFublV2OGVlQXRnelNZMHIvWHFQeUpWTThTUW5Dc2wzdEVhclUvY0pRNDV4VFRQbVB1WgpoSmJhajAxYUZtVlRPZ3RzdDJONTd3enNiOUN5bEhPMmlicDBMaW05SjA3RVpyaFZOWmtKYytaNDc4U2xhWDVMClkxV2hlZVU2OHZEWW1oKzdXcVJOb1FLQmdGUndYbDFWYjY3bVJNbnVReVlINWY4TC83dTllaDNlZStsL3h6QzcKcEFYNk11VlRWUjNLRnp4Wkp4RkNWSDh4WVRxTTVQcGo5cm4rRHEzdkxKRFJOUm5SMXdWaDhCRHJBWTF4bWJjVwpQS0s4OHlHNW1jRFNKeXJkd2xSSGh2SlF6bDM3MWxDQ0xKNndmYXRFOVhMcTNGcGFPbGtVaDRxUERucjB2a0NwCjUwaVZBb0dBY0xFVnpBdjAvMmk0S2RkK2NGeDhlSm9DcE8xcmQ5c0xEak5Jbm11VGZPK2loYWlrbnJkK3Bsd3IKdGZoU3lsc295c1pWaGRCRGVuMlpKQUZ1ZDlsRDB2NDNNMmx6WE81TmpoaGpDelM0RjRWT01EeE4xSlJqbnlFagpHTzRjMmwrZ2FWVzBTQ1JReVNLKzhxMksvRmZEQW5PbWdxWEN4eFp5SnZjS1YxVHJ1U3M9Ci0tLS0tRU5EIFJTQSBQUklWQVRFIEtFWS0tLS0tCg==
metadata:
  name: registry-tls
  namespace: default
type: Opaque

