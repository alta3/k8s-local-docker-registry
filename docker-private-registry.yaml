---
apiVersion: extensions/v1beta1
kind: DaemonSet
metadata:
  labels:
    app: docker-private-registry
  name: docker-private-registry-deployment
spec:
  #replicas: 1
  selector:
    matchLabels:
      app: docker-private-registry
  template:
    metadata:
      labels:
        app: docker-private-registry
    spec:
      containers:
      - image: registry:2
        imagePullPolicy: IfNotPresent
        name: docker-private-registry
        env: 
        - name: REGISTRY_HTTP_ADDR
          value: 0.0.0.0:5000
        - name: REGISTRY_HTTP_TLS_CERTIFICATE
          value: /certs/cert.crt
        - name: REGISTRY_HTTP_TLS_KEY
          value: /certs/cert.key
        ports:
        - containerPort: 5000
          protocol: TCP
        volumeMounts:
        - mountPath: /var/lib/registry
          name: image-store
        - mountPath: /certs
          name: certs
      volumes:
      - emptyDir: {} # THIS IS NOT PERSISTANT! WILL DELETE WITH POD!
        name: image-store
      - name: certs
        secret:
          secretName: registry-tls
          items:
          - key: tls.crt
            path: cert.crt
            mode: 256 # 0400 in decimal
          - key: tls.key
            path: cert.key
            mode: 256 # 0400 in decimal
---
apiVersion: v1
kind: Service
metadata:
  labels:
    service: docker-private-registry
  name: docker-private-registry
spec:
  ports:
  - nodePort: 30500
    port: 5000
    protocol: TCP
    targetPort: 5000
  selector:
    app: docker-private-registry
  type: NodePort

---
apiVersion: v1
kind: Secret
data:
  tls.crt: LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSUVERENDQXZTZ0F3SUJBZ0lVSDZFRkI4T2x3RFRPSXF2cXVNWm5ZeGZRVnhVd0RRWUpLb1pJaHZjTkFRRUwKQlFBd2NERUxNQWtHQTFVRUJoTUNWVk14RlRBVEJnTlZCQWdUREZCbGJtNXplV3gyWVc1cFlURVRNQkVHQTFVRQpCeE1LU0dGeWNtbHpZblZ5WnpFVE1CRUdBMVVFQ2hNS1MzVmlaWEp1WlhSbGN6RUxNQWtHQTFVRUN4TUNRMEV4CkV6QVJCZ05WQkFNVENrdDFZbVZ5Ym1WMFpYTXdIaGNOTVRneE1URXpNVGt6TWpBd1doY05NVGt4TVRFek1Ua3oKTWpBd1dqQnhNUXN3Q1FZRFZRUUdFd0pWVXpFVk1CTUdBMVVFQ0JNTVVHVnVibk41YkhaaGJtbGhNUk13RVFZRApWUVFIRXdwSVlYSnlhWE5pZFhKbk1STXdFUVlEVlFRS0V3cExkV0psY201bGRHVnpNU0V3SHdZRFZRUUxFeGhMCmRXSmxjbTVsZEdWeklGUm9aU0JCYkhSaE15QlhZWGt3Z2dFaU1BMEdDU3FHU0liM0RRRUJBUVVBQTRJQkR3QXcKZ2dFS0FvSUJBUURNOWszdEplZlRiNkJvL01PQUo5ZW1rQ1BzTkpLTXdYWnpsMmdwczM3WitHSkdPMDhRK0pXbAp3WGk1OUpDZFhBdVZvVmdFTGUyb3hpOXJ0Q1lBRnpSTHJjby9BZ3VyN2xpNjJNSTdER2tXUnlkc2JSOXROdzR1CnM1eFdyZDlxbDlPTzFpS0hsYzJBV3FnSC9DM290ck04UTRySzlGSXZmVkJQdEdKb1dXVmFzWWFoS0YxZklISWEKVTVSR2JoQ055aGE4RlZab2EyWmp1TFU0VjNBVyt2Z0R2VVFyZjlLUU9DTkZVSzhXMXNlRUdmR3VSN1MzSWdCbQpVRHRkQjVxaGRGUlBTVTMwaDB6bmNudVcxVE1mRTFYdmsyU3lNL3pqUWlKcVlaTTJRM0NjeUt3cW50ZjRMaVF4CmdVMC9yVG01TTR3TW8yVk5FUWN5QW5nZjVlNEtmSlM3QWdNQkFBR2pnWnd3Z1prd0RnWURWUjBQQVFIL0JBUUQKQWdXZ01CMEdBMVVkSlFRV01CUUdDQ3NHQVFVRkJ3TUJCZ2dyQmdFRkJRY0RBakFNQmdOVkhSTUJBZjhFQWpBQQpNQjBHQTFVZERnUVdCQlNzUWlsaXdlMWN3Z2pzYjMvV0Z0UTdWdUNHWmpBZkJnTlZIU01FR0RBV2dCU0Q4Q0MyCnpKanlHSE8rNm1xUEtvaUp4SjQ4UmpBYUJnTlZIUkVFRXpBUmdnbHNiMk5oYkdodmMzU0hCSDhBQUFFd0RRWUoKS29aSWh2Y05BUUVMQlFBRGdnRUJBTEh1dE9zVXJBTE5KRnh6T3M0UEI0UUZzL044NHlYTmpDdVJ2Z1FiY2dLQQpOMk1wdWZubVF0UDVyenB4MFVnQVFKSzNwRUNUWS9YaVgwQi9vdHZkR096ZW5XS1dDRGp1WXhsTlQ3SmpVT3duClpFUThkS3h2T2lZYVdvQmp6OFhIMmEyK1dmekY0RE1zbUdxSmtlbmZpTEs4bmwzL2ZPVTg3Mnk3ZDh0MUpIbUQKMlJYdkFCUWkxdkNTTjQ0ZUhqakNhOHBvKzlIbzVCR1Jzd2lseU90cko2aFRMNkxMTWZpWHkyWWlwWDd2TExlRgpqdzByU3UrOUdpTGkzSy9FTFdQYXQ2blE3UWFraFNVVkJSc3V0VitPODZiWW5lMHNwSVNFZFRBd2ZCeWI2bUJ2CkNzLzVIangwRkptY3J4Um5zTjFUaHV2WnJJQkVNRjZ1YnlXNTVhOXAzYUU9Ci0tLS0tRU5EIENFUlRJRklDQVRFLS0tLS0K
  tls.key: LS0tLS1CRUdJTiBSU0EgUFJJVkFURSBLRVktLS0tLQpNSUlFcEFJQkFBS0NBUUVBelBaTjdTWG4wMitnYVB6RGdDZlhwcEFqN0RTU2pNRjJjNWRvS2JOKzJmaGlSanRQCkVQaVZwY0Y0dWZTUW5Wd0xsYUZZQkMzdHFNWXZhN1FtQUJjMFM2M0tQd0lMcSs1WXV0akNPd3hwRmtjbmJHMGYKYlRjT0xyT2NWcTNmYXBmVGp0WWloNVhOZ0Zxb0Ivd3Q2TGF6UEVPS3l2UlNMMzFRVDdSaWFGbGxXckdHb1NoZApYeUJ5R2xPVVJtNFFqY29XdkJWV2FHdG1ZN2kxT0Zkd0Z2cjRBNzFFSzMvU2tEZ2pSVkN2RnRiSGhCbnhya2UwCnR5SUFabEE3WFFlYW9YUlVUMGxOOUlkTTUzSjdsdFV6SHhOVjc1TmtzalA4NDBJaWFtR1ROa053bk1pc0twN1gKK0M0a01ZRk5QNjA1dVRPTURLTmxUUkVITWdKNEgrWHVDbnlVdXdJREFRQUJBb0lCQUVmeVNjWnVJT09DY3ArSAo0cVJ3MSswNitiRW5meTN6bHozYUx4RThWZEh6czZPTm5DS0w4QlBnUngyWGNOQWNDR0Q4NHVXTXJia3A0R21CCk1qbWo2NUtKTGM1U1RJQ015UTdGbWVDYWFhVU5VeFJuZGJtanN0SEg4S0FvcHAxSE1GY2FhY0tJWGp1cEZ3UysKaStyOWZ3c3ZkbC9weFpPdi9Hb09HdUVnU0VpK0dTNU0xVFIxU1l3MjY2Q2VrQ3FnSWNtNGRxNi8vcmd5M25iRAp2ZmZJb01iQkhDaHZ2dFZJckM2b1VJeitsL1l2V3BmZXVxNGFyejcyemVMZkM5VlFrRzNlVnJsYXNlTzdHMXlICkhjcWcrQVFncmM4K3dIZ1hLcm5MSjdTTStHTHArb3BIZE1rSWd0Q2tCQ0pVYWE2OTFsVEg0WTdGWjNIUkRRN3UKMUVvQkloRUNnWUVBOC90MStOQmlwUWZxWHN5QUhta1VTT0hmbkgrRGN5SXRmTElBRXJDcW9rVmRjd2pDeWVScgp5YU9pWUU5ZktxZktHWU9xNXZLbG5PVkgxL3I3OVZ5dlJOdW5PNThITEl2RkxLKzdCMXpUMUs2ZjV2K0pjZnlvClV5SXJFZzBua2gyOTBZNmQybmh0WXJTMUxwZDNjZGZzZ3l2UFVjVzFDOHdZWjJaRGpPOGlGYWtDZ1lFQTF3N1AKMnFySFRlZ1FURHo2cmIrZXRYajRjSkxqM0d0UDFaYnovcUNzY2toaW5HMWx1SEFSak5FWGdubjdNN2JsWDc5cApxaGZNR3h2c1RZSkl1d1VYUVRZYjMwM29FZ3J4ZWplUVI3Y1czb3pINUdOWnZzZ0dhOUlBVnNRZ0wvL0hRZC9mCnFUNU9TSm9ucVV3VFBVR3ZVSU4yUmtQbTFjSzlIQXJobFgvWWpjTUNnWUVBaEpPeisweGhEZ1JMR3RCTkhqbEQKU0lkVWx4bkRPQ0R1VHIvNndpMDF5NCtkeEJDU3FGcHpKOUsvUFU1a0RDMjQ2RHhmOWJjTXYwRG4xVGtSQ0xjZwpsbTQxWlhSNDFYL3QyT1owM3Y5V0xFL25uQUpua1lVVmduY2lxR0IxakRTVkhQWStXS1R2NjU3K2hSN1JUUTlqCitiTW9xT3FpQXBNWS83YldKaE1ibG1FQ2dZRUF1Z2JVQVlETW1qVnRNNlZqNmp2aEczVWk0cTROY0xOYkFaVnMKUmd2U1g2RUJ1L0pkbFNkTDV4VlBVc3dWWVd5S0NVTFlNZ3dYd0ROdE9yYkNGeFNXUXhCOUY3S2FWbEVsQk9WZgpac21YZkxjbWlnYnVzTHJ4NHY1cTBLTWlmS0t5UitkUjMySkg4VUYzb1ZodkpBUFhsTHZDNlpEKzhsVmJwQkE5CmhrWnFtbVVDZ1lBUDRiMGVKcEdtSmJaSG9vUmZsbThlYWNpbDQxcEF6bFRyMVJLd0xuMDNGaHZiUXRhK3VHYWcKVFNxLzRPQkMrbW53eWgrdVJqbWtGL1lucW5PUWZnelFWc21ZYUgvK0hPRStmT05KR0ttRmt5NDJxNTN3WHF4VApvVDRNODUxTVNSWERJMlk2Y28xK0JMMUd0VFoxbWlvNytJRG5XQlg2YU1hWXNySGwrYnBWWkE9PQotLS0tLUVORCBSU0EgUFJJVkFURSBLRVktLS0tLQo= 
metadata:
  name: registry-tls
  namespace: default
type: Opaque

